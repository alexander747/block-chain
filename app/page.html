<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- <script
      type="text/javascript"
      src="https://cdn.plot.ly/plotly-latest.min.js"
    ></script> -->

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Install a specific version -->
    <script
      type="text/javascript"
      src="https://cdn.plot.ly/plotly-1.9.0.min.js"
    ></script>

    <style>
      body {
        margin: 20px auto;
        font-family: "Lato";
        font-weight: 300;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- <div id="line-chart"></div> -->
    <div id="myDiv"></div>
  </body>
  <!-- <script>
    window.onload = function () {
      setTimeout(function () {
        datosApi();
      }, 2000);
    };
    var lineDiv = document.getElementById("line-chart");

    var traceA = {
      x: [25, 30, 35, 40, 45, 50, 55],
      y: [40, 40, 20, 60, 40, 20, 50],
      type: "scatter",
    };

    var data = [traceA];

    var layout = {
      title: "A Line Chart in Plotly",
      height: 550,
      font: {
        family: "Lato",
        size: 16,
        color: "rgb(100,150,200)",
      },
      plot_bgcolor: "rgba(200,255,0,0.1)",
      margin: {
        pad: 10,
      },
      xaxis: {
        title: "Distance travelled along x-axis",
        titlefont: {
          color: "black",
          size: 12,
        },
        rangemode: "tozero",
      },
      yaxis: {
        title: "Distance travelled along y-axis",
        titlefont: {
          color: "black",
          size: 12,
        },
        rangemode: "tozero",
      },
    };

    var datosApi = async () => {
      var url = "/blocks";
      var data = await fetch(url);
      var data = await data.json();
      console.log(data);
      setTimeout(function () {
        var traceA = {
          x: [10, 10, 25, 30, 35, 40, 50],
          y: [10, 50, 45, 50, 40, 20, 50],
          type: "scatter",
        };
        var traseB = {
          x: [],
          y: [],
        };
        data = [traseB];
        Plotly.plot(lineDiv, data, layout);
        data = [traceA];

        Plotly.plot(lineDiv, data, layout);
      }, 3000);
    };

    Plotly.plot(lineDiv, data, layout);
  </script> -->
  <script>
    window.onload = function () {};
    var data = [
      {
        x: ["10", "12", "13", "14", "15", "16"],
        y: [0, 200, 400, 600, 800, 1000],
        type: "scatter",
      },
    ];

    (function () {
      Plotly.newPlot("myDiv", data);
      setInterval(() => {
        console.log("vaciando");
        vaciar();
        iniciar();
      }, 3000);

      setInterval(() => {
        llenar();
        iniciar();
        console.log("llenando");
      }, 4000);
    })();

    function vaciar() {
      data = [
        {
          x: [],
          y: [],
          type: "scatter",
        },
      ];
    }
    async function llenar() {
      var dataApi = await fetch("blocks");
      var dataApi = await dataApi.json();
      console.log(dataApi);
      var ultimaPosicion = dataApi.length - 1;
      console.log("el ultmo data es " + ultimaPosicion);

      console.log(dataApi[ultimaPosicion].data.frecuencia);
      console.log(dataApi[ultimaPosicion].data.tiempo);
      let x = dataApi[ultimaPosicion].data.frecuencia;
      let y = dataApi[ultimaPosicion].data.tiempo;
      if (y == undefined && x == undefined) {
        y = 0;
        x = 0;
      }

      data = [
        {
          x: ["10", "12", "13", "14", "15", "16"],
          y: [0, 200, 400, 600, 800, 1000],
          type: "scatter",
        },
      ];
    }

    // async function getData() {
    //   var dataApi = await fetch("blocks");
    //   var dataApi = await dataApi.json();
    //   console.log(dataApi);
    //   var ultimaPosicion = dataApi.length - 1;
    //   console.log("el ultmo data es " + ultimaPosicion);

    //   console.log(dataApi[ultimaPosicion].data.frecuencia);
    //   console.log(dataApi[ultimaPosicion].data.tiempo);
    //   let x = dataApi[ultimaPosicion].data.frecuencia;
    //   let y = dataApi[ultimaPosicion].data.tiempo;

    // }

    function iniciar() {
      Plotly.newPlot("myDiv", data);
    }
  </script>
</html>
